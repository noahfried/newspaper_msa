install.packages("AER")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(AER)
library(tidyverse)
folder <- "data"
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdraw)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal)
View(data)
View(data)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdraw)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
brinkmanlin <- read_csv(file.path(folder, "pr5112msa.csv"))
brinkmanlin_filtered <- brinkmanlin %>% filter(!is.na(smsa),open90!= 0)
View(brinkmanlin)
View(brinkmanlin)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(msa),open90!= 0)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(msa),open90!= 0)
View(data2)
View(data2)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(MSA),open90!= 0)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(MSA),OPEN90!= 0)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(SMSA),OPEN90!= 0)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(smsacode),OPEN90!= 0)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(smsacode),OPEN90!= 0)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_in_km, starts_with("OPEN"))
View(data2_filtered)
View(data2_filtered)
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(smsacode),OPEN90!= 0)
data2_selected <- data2_filtered %>% select(msa = smsacode, length = length_in_km, starts_with("OPEN"))
folder <- "data"
data <- read_csv(file.path(folder, "hwys2msa.csv"))
data_filtered <- data %>% filter(withdrawal == 1)
data_selected <- data_filtered %>% select(msa = smsacode, length = length_msa_km, withdrawal)
temp_file <- tempfile(fileext = ".csv")
write_csv(data_selected, temp_file)
data2 <- read_csv(file.path(folder, "pr5112msa.csv"))
data2_filtered <- data2 %>% filter(!is.na(smsacode),OPEN90!= 0)
data2_selected <- data2_filtered %>% select(msa = smsacode, length = length_in_km, starts_with("OPEN"))
data2_selected <- data2_selected %>% mutate(withdrawal = 0)
View(data2_selected)
View(data2_selected)
View(data_selected)
View(data_selected)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1)
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdraw) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0)
select(msa = smsacode, length = length_in_km, starts_with("OPEN"))
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0)
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0)
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
View(combined)
View(combined)
arrange(combined, msa, withdrawal)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted < - arrange(combined, msa, withdrawal)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdraw)) %>%
ungroup()
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdrawal)) %>%
ungroup()
# Display the updated dataset
print(sorted)
knitr::opts_chunk$set(echo = TRUE)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
library(tidyverse)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdrawal)) %>%
ungroup()
collapsed_data <- combined_data %>%
group_by(msa, withdraw) %>%
summarize(length = sum(length, na.rm = TRUE), .groups = 'drop')
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdrawal)) %>%
ungroup()
collapsed_data <- sorted %>%
group_by(msa, withdraw) %>%
summarize(length = sum(length, na.rm = TRUE), .groups = 'drop')
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdrawal)) %>%
ungroup()
collapsed_data <- sorted %>%
group_by(msa, withdrawal) %>%
summarize(length = sum(length, na.rm = TRUE), .groups = 'drop')
# Calculate total length for each msa
collapsed_data <- collapsed_data %>%
group_by(msa) %>%
mutate(total_length = sum(length, na.rm = TRUE)) %>%
ungroup()
# Generate frac_length and handle precision issues
collapsed_data <- collapsed_data %>%
mutate(frac_length = length / total_length,
frac_length = ifelse(frac_length > 0.9999, 1, frac_length))
# Display the updated dataset
print(collapsed_data)
#Read in first dataset, withdrawn
folder <- "data"
data1 <- read_csv(file.path(folder, "hwys2msa.csv")) %>%
filter(withdrawal == 1) %>%
select(msa = smsacode, length = length_msa_km, withdrawal)
#Read in second dataset, completed
data2 <- read_csv(file.path(folder, "pr5112msa.csv")) %>%
filter(!is.na(smsacode),OPEN90!= 0) %>%
select(msa = smsacode, length = length_in_km, starts_with("OPEN")) %>%
mutate(withdrawal = 0)
#append
combined <- bind_rows(data1, data2)
#sort
sorted <- arrange(combined, msa, withdrawal)
sorted <- sorted %>%
group_by(msa) %>%
mutate(has_withdraw = max(withdrawal)) %>%
ungroup()
collapsed_data <- sorted %>%
group_by(msa, withdrawal) %>%
summarize(length = sum(length, na.rm = TRUE), .groups = 'drop')
# Calculate total length for each msa
collapsed_data <- collapsed_data %>%
group_by(msa) %>%
mutate(total_length = sum(length, na.rm = TRUE)) %>%
ungroup()
# Generate frac_length and handle precision issues
collapsed_data <- collapsed_data %>%
mutate(frac_length = length / total_length,
frac_length = ifelse(frac_length > 0.9999, 1, frac_length))
# Sort by msa and descending withdrawal
sorted_data <- collapsed_data %>%
arrange(msa, desc(withdrawal))
# Tagging the first occurrence of each msa
tagged_data <- sorted_data %>%
group_by(msa) %>%
filter(row_number() == 1) %>%
ungroup()
# Replace frac_length with 0 where withdrawal is 0
tagged_data <- tagged_data %>%
mutate(frac_length = ifelse(withdrawal == 0, 0, frac_length))
# Drop columns withdrawal, tag, and length
msahwy <- tagged_data %>%
select(-withdrawal, -length) %>%
rename(frac_length_withdrawn = frac_length)
# Save the final dataframe to a CSV file
write_csv(msahwy, file.path(folder, "msahwy.csv"))
# Display the final dataframe
print(msahwy)
install.packages("ivreg", dependencies = TRUE)
library(tidyverse)
library(ivreg)
library(ivreg)
